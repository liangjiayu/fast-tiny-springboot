# fast-tiny-springboot

## ç®€ä»‹

åŸºäº springboot çš„å¿«é€Ÿå¼€å‘çš„æ¡†æ¶ï¼Œå¯ç”¨äºç°ä»£ web æœåŠ¡æ¥å£å¼€å‘ï¼Œå¼€ç®±å³ç”¨ï¼Œä¸€é”®éƒ¨ç½² ğŸš€

## é¡¹ç›®å±•ç¤º

**å¸¸è§„çš„å•è¡¨ CRUD**

![](./doc/image01.png)

**æŸ¥è¯¢è¯¦æƒ…å“åº”ä½“**

![](./doc/image02.png)

## æŠ€æœ¯é€‰å‹

| æŠ€æœ¯                   | ç‰ˆæœ¬     | è¯´æ˜                                        |
| :--------------------- | -------- | ------------------------------------------- |
| spring-boot            | 3.4.2    | MVC æ¡†æ¶ï¼ŒåŠŸèƒ½åŒ…æ‹¬ web æœåŠ¡ã€æ£€éªŒã€åˆ‡é¢ç­‰ç­‰ |
| springdoc-openapi      | 2.8.4    | swagger æ–‡æ¡£ç”Ÿæˆå·¥å…·                        |
| mysql-connector-j      | 9.2.0    | mysql æ•°æ®åº“é©±åŠ¨                            |
| mybatis-plus           | 3.5.10.1 | ORM æ¡†æ¶ï¼ŒMyBatis å¢å¼ºå·¥å…·                  |
| mybatis-plus generator | 3.5.10.1 | ä»£ç ç”Ÿæˆå™¨                                  |
| hutool                 | 5.8.35   | Java å·¥å…·ç±»åº“                               |
| lombok                 | 1.18.36  | ç®€åŒ–ä»£ç å·¥å…·                                |

## é¡¹ç›®ç»“æ„

#### ä¸šåŠ¡æ¨¡å—ç»“æ„

```shell
â”œâ”€â”€ pom.xml                          #  ä¸šåŠ¡æ¨¡å—çš„é…ç½®æ–‡ä»¶ï¼Œå®šä¹‰ä¾èµ–ã€æ’ä»¶å’Œæ„å»ºé…ç½®
â”œâ”€â”€ src
â”‚   â”œâ”€â”€ main
â”‚   â”‚   â”œâ”€â”€ java
â”‚   â”‚   â”‚   â””â”€â”€ admin
â”‚   â”‚   â”‚       â”œâ”€â”€ AdminApplication.java          # Spring Boot å¯åŠ¨ç±»
â”‚   â”‚   â”‚       â”œâ”€â”€ config                          # é…ç½®ç±»ç›®å½•
â”‚   â”‚   â”‚       â”‚   â”œâ”€â”€ ModuleExceptionHandler.java  # å…¨å±€å¼‚å¸¸å¤„ç†å™¨
â”‚   â”‚   â”‚       â”‚   â”œâ”€â”€ MybatisPlusConfig.java      # MyBatis-Plus é…ç½®ç±»
â”‚   â”‚   â”‚       â”‚   â””â”€â”€ OpenApiConfig.java          # OpenAPI (Swagger) é…ç½®ç±»
â”‚   â”‚   â”‚       â”œâ”€â”€ controller                      # æ§åˆ¶å™¨å±‚ï¼Œå¤„ç† HTTP è¯·æ±‚
â”‚   â”‚   â”‚       â”œâ”€â”€ dto                             # æ•°æ®ä¼ è¾“å¯¹è±¡ç›®å½•
â”‚   â”‚   â”‚       â”œâ”€â”€ enums                           # æšä¸¾ç±»ç›®å½•
â”‚   â”‚   â”‚       â”œâ”€â”€ mapper                          # MyBatis Mapper æ¥å£ç›®å½•
â”‚   â”‚   â”‚       â”œâ”€â”€ model                           # å®ä½“ç±»ç›®å½•
â”‚   â”‚   â”‚       â””â”€â”€ service                         # æœåŠ¡å±‚ç›®å½•
â”‚   â”‚   â”‚           â””â”€â”€ impl                        # æœåŠ¡å®ç°ç±»ç›®å½•
â”‚   â”‚   â””â”€â”€ resources
â”‚   â”‚       â”œâ”€â”€ application-dev.yml      # å¼€å‘ç¯å¢ƒé…ç½®æ–‡ä»¶
â”‚   â”‚       â”œâ”€â”€ application-prod.yml     # ç”Ÿäº§ç¯å¢ƒé…ç½®æ–‡ä»¶
â”‚   â”‚       â”œâ”€â”€ application.yml          # å…¨å±€é…ç½®æ–‡ä»¶
â”‚   â”‚       â”œâ”€â”€ mapper                   # MyBatis XML æ˜ å°„æ–‡ä»¶ç›®å½•
â”‚   â”‚       â””â”€â”€ static                   # é™æ€èµ„æºç›®å½•ï¼ˆCSS/JS/å›¾ç‰‡ç­‰ï¼‰
â”‚   â””â”€â”€ test                             # æµ‹è¯•ä»£ç ç›®å½•
â””â”€â”€ target                               # Maven æ„å»ºè¾“å‡ºç›®å½•
```

#### é€šç”¨æ¨¡å—ç»“æ„

```shell
â”œâ”€â”€ src
â”‚   â””â”€â”€ main
â”‚       â”œâ”€â”€ java
â”‚       â”‚   â””â”€â”€ common  # å…¬å…±æ¨¡å—
â”‚       â”‚       â”œâ”€â”€ api  # ç»Ÿä¸€æ¥å£å“åº”å°è£…
â”‚       â”‚       â”‚   â”œâ”€â”€ CommonResult.java  # ç»Ÿä¸€å“åº”ç»“æœåŒ…è£…ç±»ï¼ˆå¦‚æˆåŠŸ/å¤±è´¥æ ¼å¼ï¼‰
â”‚       â”‚       â”‚   â”œâ”€â”€ IErrorCode.java    # é”™è¯¯ç æ¥å£ï¼ˆå®šä¹‰é”™è¯¯ç è§„èŒƒï¼‰
â”‚       â”‚       â”‚   â””â”€â”€ ResultCode.java    # å…·ä½“é”™è¯¯ç æšä¸¾ï¼ˆå¦‚ 200=æˆåŠŸï¼Œ500=ç³»ç»Ÿé”™è¯¯ï¼‰
â”‚       â”‚       â”œâ”€â”€ dto  # æ•°æ®ä¼ è¾“å¯¹è±¡åŸºç±»
â”‚       â”‚       â”‚   â””â”€â”€ BasePages.java     # åˆ†é¡µæŸ¥è¯¢å‚æ•°åŸºç±»ï¼ˆåŒ…å« pageNum/pageSizeï¼‰
â”‚       â”‚       â”œâ”€â”€ exception  # å…¨å±€å¼‚å¸¸å¤„ç†
â”‚       â”‚       â”‚   â”œâ”€â”€ ApiException.java            # è‡ªå®šä¹‰ä¸šåŠ¡å¼‚å¸¸ç±»
â”‚       â”‚       â”‚   â””â”€â”€ GlobalExceptionHandler.java  # å…¨å±€å¼‚å¸¸å¤„ç†å™¨ï¼ˆç»Ÿä¸€è¿”å›é”™è¯¯æ ¼å¼ï¼‰
â”‚       â”‚       â”œâ”€â”€ generator
â”‚       â”‚       â”‚   â””â”€â”€ CodeGenerator.java # ä»£ç ç”Ÿæˆå™¨
â”‚       â”‚       â””â”€â”€ validator  # è‡ªå®šä¹‰æ ¡éªŒå™¨
â”‚       â”‚           â”œâ”€â”€ EnumValidator.java  # æšä¸¾æ ¡éªŒå™¨å®ç°
â”‚       â”‚           â””â”€â”€ ValidEnum.java      # æšä¸¾æ ¡éªŒæ³¨è§£
â”‚       â””â”€â”€ resources  # èµ„æºæ–‡ä»¶ç›®å½•
â””â”€â”€ pom.xml  # Maven å…¬å…±é¡¹ç›®é…ç½®æ–‡ä»¶ï¼Œåªå®šä¹‰é€šç”¨ä¾èµ–
```

## ä½¿ç”¨æµç¨‹

### ç¯å¢ƒæ­å»º

- æ•°æ®åº“é»˜è®¤ç‰ˆæœ¬ä¸º 8.0ï¼Œæ”¯æŒ 5.7 çš„ç‰ˆæœ¬ï¼Œæ•°æ®åº“åˆå§‹åŒ–è¿è¡Œ [sql è„šæœ¬](./sql/sys_users.sql)ï¼Œå¯å¿«é€Ÿè¿è¡Œé¡¹ç›®ã€‚
- JDK ç‰ˆæœ¬éœ€è¦ 17 ä»¥ä¸Šï¼Œé¡¹ç›®é»˜è®¤ä¸º 17ï¼Œå¯åœ¨`pom`æ–‡ä»¶ä¸­ä¿®æ”¹ã€‚

### é¡¹ç›®è¿è¡Œ

ç›´æ¥é€šè¿‡`idea`è¿è¡Œä¸šåŠ¡æ¨¡å—çš„`AdminApplication`å¯åŠ¨ç±»å³å¯ã€‚

### ä¸šåŠ¡ä»£ç å¼€å‘

é€šè¿‡`CodeGenerator`ä¸€é”®ç”Ÿæˆä¸šåŠ¡ä»£ç æ–‡ä»¶ï¼Œæ–‡ä»¶åŒ…æ‹¬ controllerã€mapperã€modelã€serviceã€xmlï¼Œå¹¶ä¸”æœ‰å¯ç›´æ¥è¿è¡Œçš„ CURD ä»£ç ã€‚

ä»£ç ç”Ÿæˆå™¨åœ¨ `common -> generator -> CodeGenerator` æ¨¡å—ä¸­ï¼Œé€šè¿‡ `idea`è¿è¡Œè„šæœ¬ã€‚

1. è®¾è®¡è¡¨å­—æ®µï¼Œå¹¶ä¸”ä¸€å®šè¦å†™å¥½å­—æ®µçš„æ³¨é‡Šï¼Œç”Ÿæˆå™¨ä¼šè‡ªåŠ¨ç”Ÿæˆåœ¨çº¿æ–‡æ¡£å­—æ®µè¯´æ˜ã€‚
2. è¿è¡Œä»£ç ç”Ÿæˆå™¨ï¼Œè¾“å…¥è¡¨çš„åç§°ï¼Œå¦‚å›¾ ![](./doc/image03.png)
3. ç”Ÿæˆçš„æ–‡ä»¶åœ¨`generatorFile`ç›®å½•ä¸­ï¼Œæ‰‹åŠ¨æŠŠç”Ÿæˆçš„æ–‡ä»¶æ‹–åŠ¨åˆ°ä¸šåŠ¡æ¨¡å—ä¸­ï¼Œæ–‡ä»¶ç›®å½•å¦‚å›¾ ![](./doc/image04.png)
4. ç”Ÿæˆçš„ä»£ç å¯ç›´æ¥è¿è¡Œï¼Œæœ‰åŸºç¡€çš„ curdï¼Œç”Ÿæˆçš„åœ¨çº¿æ–‡æ¡£å¦‚å›¾ ![](./doc/image05.png)

## ä¸€é”®éƒ¨ç½²

### å‡†å¤‡å·¥ä½œ

#### æœåŠ¡å™¨ç¯å¢ƒ

- ç¡®ä¿æœåŠ¡å™¨å·²å®‰è£… Docker å’Œ Docker Composeã€‚
- åœ¨æœåŠ¡å™¨ä¸Šåˆ›å»ºé¡¹ç›®ç›®å½•ï¼ˆä¾‹å¦‚ `/home/admin/fast-tiny-app`ï¼‰ï¼Œå¹¶ä¸Šä¼  `docker-compose.yml`å’Œ`.env` æ–‡ä»¶ï¼Œå…·ä½“å¯å‚è€ƒé¡¹ç›® [æœåŠ¡ç«¯é…ç½®](./service-config/)

#### â€‹GitHub Secrets é…ç½®

åœ¨ä»“åº“çš„ `Settings -> Secrets -> Actions` ä¸­æ·»åŠ ä»¥ä¸‹å¯†é’¥ï¼š

| Secret åç§°        | ä½œç”¨è¯´æ˜                                            |
| :----------------- | --------------------------------------------------- |
| SERVER_HOST        | éƒ¨ç½²æœåŠ¡å™¨çš„å…¬ç½‘ IP                                 |
| SSH_USERNAME       | ç™»å½•æœåŠ¡å™¨çš„ SSH ç”¨æˆ·åï¼Œé»˜è®¤ä¸º root                |
| SSH_PRIVATE_KEY    | ç”¨äº SSH ç™»å½•æœåŠ¡å™¨çš„ç§é’¥å†…å®¹ï¼ˆéœ€ä¸æœåŠ¡å™¨å…¬é’¥é…å¯¹ï¼‰ |
| DOCKERHUB_USERNAME | Docker Hub è´¦å·ç”¨æˆ·å                               |
| DOCKERHUB_TOKEN    | Docker Hub çš„è®¿é—®ä»¤ç‰Œ                               |

#### docker-compose.yml å’Œ.env ç¤ºä¾‹

```yml
services:
  app:
    image: ${IMAGE_FULL_NAME}
    container_name: ${IMAGE_NAME}
    restart: unless-stopped
    ports:
      - "7100:7100"
```

```bash
IMAGE_FULL_NAME=domain/my-image:latest
IMAGE_NAME=my-image
```

### éƒ¨ç½²æ­¥éª¤

#### é€šè¿‡ GitHub Actions æ‰‹åŠ¨è§¦å‘

1. è¿›å…¥ GitHub ä»“åº“çš„ â€‹Actionsâ€‹ æ ‡ç­¾é¡µã€‚
2. é€‰æ‹© **â€‹Deploy to Server**â€‹ å·¥ä½œæµç¨‹ï¼Œç‚¹å‡» **â€‹Run workflow**ã€‚
3. é€‰æ‹©éƒ¨ç½²ç¯å¢ƒï¼š
   - daily: æ—¥å¸¸ç¯å¢ƒï¼ˆé»˜è®¤ï¼‰ã€‚
   - prod: ç”Ÿäº§ç¯å¢ƒã€‚
4. ç‚¹å‡» **â€‹Run workflow**â€‹ å¼€å§‹éƒ¨ç½²ã€‚
5. ç­‰å¾…æ„å»ºå’Œéƒ¨ç½²å®Œæˆï¼Œè§‚å¯Ÿæ—¥å¿—æ˜¯å¦æœ‰é”™è¯¯ã€‚

### éªŒè¯éƒ¨ç½²

```bash
# â€‹æ£€æŸ¥å®¹å™¨çŠ¶æ€â€‹
docker ps -f name=fast-tiny-app
# æŸ¥çœ‹åº”ç”¨æ—¥å¿—
docker logs fast-tiny-app
# è®¿é—®åº”ç”¨ URL
open http://<æœåŠ¡å™¨IP>:7100
```

### æ³¨æ„äº‹é¡¹

1. é”™è¯¯æ’æŸ¥
   - è‹¥éƒ¨ç½²å¤±è´¥ï¼Œæ£€æŸ¥ GitHub Actions æ—¥å¿—ä¸­çš„é”™è¯¯ä¿¡æ¯ã€‚
   - ç¡®ä¿æœåŠ¡å™¨çš„ SSH å¯†é’¥æƒé™æ­£ç¡®
2. å›æ»šæ“ä½œ
   è‹¥éœ€å›æ»šï¼Œå¯æ‰‹åŠ¨åœ¨æœåŠ¡å™¨æ‰§è¡Œï¼š

```bash
cd /home/admin/fast-tiny-app

# è®¾ç½®ç¯å¢ƒå˜é‡
IMAGE_FULL_NAME="docker.io/xxxx/fast-tiny-app:<æ ‡ç­¾æ—¥æœŸ>"
echo "IMAGE_FULL_NAME=$IMAGE_FULL_NAME" > .env
echo "IMAGE_NAME=fast-tiny-app" >> .env

# é‡æ–°éƒ¨ç½²é•œåƒ
docker-compose down || true
docker-compose pull
docker-compose up -d
```

## å…¶ä»–è¯´æ˜

- é€šè¿‡`CommonResult`è¿”å›ç»Ÿä¸€çš„ç»“æ„ä½“ï¼Œå…¶ä¸­`CommonResult.success`ä¸ºæˆåŠŸï¼Œ`CommonResult.failed`ä¸ºå¤±è´¥ã€‚
- ä¸šåŠ¡å¼‚å¸¸å¯é€šè¿‡ `throw new ApiException("xxx")`ï¼Œå…¨å±€å¼‚å¸¸ä¼šè‡ªåŠ¨æ•è·ï¼Œè¿”å›ç»Ÿä¸€é”™è¯¯ã€‚
- æšä¸¾çš„æ£€éªŒï¼Œå¯ä½¿ç”¨`ValidEnum`æ³¨è§£ï¼Œå¦‚` @ValidEnum(enumClass = GenderEnum.class, message = "æ€§åˆ«ç¼–ç ä¸åˆæ³•")`ã€‚
